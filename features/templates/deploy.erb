require File.expand_path(File.join(File.dirname(__FILE__), "..", "..", "..", "lib", "auto_tagger", "recipes"))

set :autotagger_stages, ["<%= environments.join('", "') %>"]

set :application, "deployed"
set :user, "<%= user %>"
set :repository,  "file://<%= repository %>"
set :deploy_to, "<%= deploy_to %>"
set :scm, :git
set :scm_command, "<%= git_location %>"

set :run_method, :run
set :ssh_options, { :forward_agent => true }
default_run_options[:pty] = true

role :app, "localhost" # => this must be mapped


namespace :deploy do
  task :restart do
    puts "restarting..."
  end
end

<% environments.each do |environment| %>
task "<%= environment %>" do
  set :stage, "<%= environment %>"
end
<% end %>

before "deploy:update_code", "release_tagger:set_branch"
after  "deploy", "release_tagger:create_tag"
after  "deploy", "release_tagger:write_tag_to_shared"
after  "deploy", "release_tagger:print_latest_tag"
